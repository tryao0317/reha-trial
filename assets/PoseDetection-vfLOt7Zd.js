import{r as t,_ as M,j as p}from"./index-Dr6qfEEp.js";let _,v,y;const F=({setDebugInfo:u,setError:i,onPoseResults:d})=>{const a=t.useRef(null),s=t.useRef(null),C=t.useRef(null),c=t.useRef(null),m=t.useRef(null),o=t.useRef(null),b=t.useRef(!0),[w,j]=t.useState(!1),[k,x]=t.useState(!1),r=t.useCallback(e=>{const n=new Date().toLocaleTimeString();console.log(`[PoseDetection] ${e}`),u&&u(l=>[...l.slice(-9),`${n}: ${e}`])},[u]);t.useEffect(()=>()=>{b.current=!1,m.current&&m.current.getTracks().forEach(e=>e.stop()),c.current&&c.current.close(),o.current&&cancelAnimationFrame(o.current)},[]);const R=t.useCallback(async()=>{try{r("Requesting camera access...");const e=await navigator.mediaDevices.getUserMedia({video:!0});m.current=e,a.current&&(a.current.srcObject=e,await a.current.play()),x(!0),r("Camera is ready.")}catch(e){i&&i("カメラの起動に失敗しました"),console.error("Camera error:",e)}},[i,r]),h=t.useCallback(async()=>{try{r("Starting MediaPipe Tasks Vision initialization...");const e=await M(()=>import("./vision_bundle-DieMjNca.js"),[]);_=e.FilesetResolver,v=e.PoseLandmarker,y=e.DrawingUtils,r("MediaPipe modules imported successfully");const n=await _.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.22/wasm");r("FilesetResolver initialized with CDN WASM path"),c.current=await v.createFromOptions(n,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/latest/pose_landmarker_lite.task"},runningMode:"VIDEO",numPoses:1}),r("PoseLandmarker created successfully"),j(!0),i(null)}catch(e){console.error("MediaPipe init error:",e),i&&i(`MediaPipe初期化エラー: ${e.message||e}`),r(`MediaPipe initialization failed: ${e.message||e}`)}},[i,r]),f=t.useCallback(async()=>{if(!c.current||!a.current||!s.current)return;const e=performance.now(),n=await c.current.detectForVideo(a.current,e);if(n&&n.landmarks){d&&d(n);const l=s.current.getContext("2d");l.clearRect(0,0,s.current.width,s.current.height);const g=new y(l);for(const P of n.landmarks)g.drawLandmarks(P,{color:"red",radius:3}),g.drawConnectors(P,v.POSE_CONNECTIONS,{color:"lime",lineWidth:2})}o.current=requestAnimationFrame(f)},[d]);return t.useEffect(()=>{R(),h()},[R,h]),t.useEffect(()=>{w&&k&&(a.current&&s.current&&(s.current.width=a.current.videoWidth,s.current.height=a.current.videoHeight),o.current=requestAnimationFrame(f))},[w,k,f]),p.jsxs("div",{ref:C,className:"relative w-full bg-black",children:[p.jsx("video",{ref:a,className:"absolute inset-0 w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0}),p.jsx("canvas",{ref:s,className:"absolute inset-0 w-full h-full object-cover"})]})};export{F as default};
