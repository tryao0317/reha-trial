import{r as t,_ as y,j as f}from"./index-BwY8TfYb.js";let k,p,v;const D=({setDebugInfo:l,setError:o,onPoseResults:w})=>{const s=t.useRef(null),i=t.useRef(null),n=t.useRef(null),u=t.useRef(null),d=t.useRef(null),m=t.useRef(!0),[C,h]=t.useState(!1);t.useEffect(()=>(m.current=!0,P(),()=>{m.current=!1,u.current&&u.current.getTracks().forEach(e=>e.stop()),d.current&&cancelAnimationFrame(d.current),n.current&&n.current.close()}),[]);const r=t.useCallback(e=>{const a=new Date().toLocaleTimeString();console.log(`[PoseDetection] ${e}`),l&&l(c=>[...c.slice(-9),`${a}: ${e}`])},[l]),P=async()=>{try{r("Requesting camera access...");const e=await navigator.mediaDevices.getUserMedia({video:!0});u.current=e,s.current&&(s.current.srcObject=e,await s.current.play()),r("Camera is ready."),_()}catch(e){console.error("Camera error:",e),o&&o("カメラの初期化に失敗しました")}},_=async()=>{try{r("Starting MediaPipe Tasks Vision initialization...");const e=await y(()=>import("./vision_bundle-DieMjNca.js"),[]);k=e.FilesetResolver,p=e.PoseLandmarker,v=e.DrawingUtils,r("MediaPipe modules imported successfully");const a=await k.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/wasm");r("FilesetResolver initialized with CDN WASM path"),n.current=await p.createFromOptions(a,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/latest/pose_landmarker_lite.task"},runningMode:"VIDEO",numPoses:1}),r("PoseLandmarker created successfully"),h(!0),x()}catch(e){console.error("MediaPipe init error:",e),o&&o(`MediaPipe初期化エラー: ${e.message||e}`),r(`MediaPipe initialization failed: ${e}`)}},x=()=>{if(!n.current||!s.current)return;const e=async()=>{if(!m.current)return;const a=await n.current.detectForVideo(s.current,performance.now());if(i.current){const c=i.current.getContext("2d");c.clearRect(0,0,i.current.width,i.current.height);const R=new v(c);if(a.landmarks)for(const g of a.landmarks)R.drawLandmarks(g),R.drawConnectors(g,p.POSE_CONNECTIONS)}w&&w(a),d.current=requestAnimationFrame(e)};e()};return f.jsxs("div",{className:"relative w-full max-w-4xl bg-black",children:[f.jsx("video",{ref:s,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto rounded-lg"}),f.jsx("canvas",{ref:i,className:"absolute top-0 left-0 w-full h-full",width:640,height:480})]})};export{D as default};
